import { Callout } from "nextra-theme-docs";

# Linuxda DE(desktop environment) qanday ishlaydi?

### Maqolaning maqsadi

Ushbu maqola Linux-da grafik stack qanday ishlashi, xususan Xorg va Mesa-ga e'tibor qaratish va Linuxda turli stacklari qanday ishlashi haqida texnik tushuncha berishga qaratilgan.

Biz Linuxda keng qoʻllaniladigan displey serveri Xorg va grafik spetsifikatsiyalarning open-source dasturiy taʼminoti Mesa ning roli va arxitekturasini koʻrib chiqamiz. Ushbu elementlarni tushunish Linuxda ilovalarni ishlab chiqish yoki tizimlarni boshqarishni istagan har bir kishi uchun juda muhimdir, chunki ular grafikalar qanday ko'rsatilishi va ko'rsatilishida muhim rol o'ynaydi.

Bundan tashqari, biz GNOME, XFCE4, Cinnamon va KDE kabi turli xil mashhur Linux desktop environmentlarini o'rganamiz, ularning tuzilmalari, komponentlari, konfiguratsiya variantlari va Xorg va Mesa bilan qanday o'zaro ta'sirini tushunamiz.

Siz tajribali Linux foydalanuvchisi bo'lasizmi, tizimingizning ichki ishlashiga qiziqqan yangi foydalanuvchi yoki sozlashingizni optimallashtirishni xohlayotgan tizim administratori bo'lasizmi, ushbu maqola sizga kerakli bilim va tushunchalarni taqdim etishga qaratilgan. 

## Xorg haqida umumiy ma'lumot

Xorg, shuningdek, X.org yoki X.Org Server deb ataladi, Unix-ga o'xshash operatsion tizimlar, shu jumladan Linux bilan ishlaydigan desktop environment kompyuterlari uchun eng mashhur displey serveridir. Ba'zan windowing system deb ataladigan displey serveri ilovalarning ekranda grafik chiqishini ko'rsatish usulini ta'minlovchi komponent hisoblanadi.

Xorg open-source loyiha bo'lib, X.Org Foundation tomonidan boshqariladi va X Window System (odatda X11 yoki X nomi bilan tanilgan) ga asoslangan. Xorg Linux va boshqa Unix-ga o'xshash operatsion tizimlardagi ko'plab desktop environmentlari uchun standart displey serveridir.

## Xorg arxitekturasi va funksionalligi

Xorg arxitekturasi client-server modeliga asoslangan. Xorg serveri kompyuter hardwareida ishlaydi va grafik hardwarelar bilan communicating qilish(aloqa qilish), input devicelari bilan ishlash va displeyni boshqarish kabi vazifalar uchun javob beradi. Applicationlar, bu kontekstda, o'zlarining grafik natijalarini ko'rsatish uchun server bilan bog'lanadigan clientlardir.

Xorg arxitekturasining asosiy xususiyati uning network transparency-dir. Bu shuni anglatadiki, applications (clientlar) Xorg serverida ishlaydigan kompyuterdan boshqa kompyuterda ishlashi mumkin. Clientlar X11 deb nomlangan tarmoq protokoli orqali server bilan bog'lanadi.

Chizilgan oynalarni chizish va ma'lumotlarni qayta ishlashning asosiy funksiyalaridan tashqari, Xorg qo'shimcha funksiyalarni ta'minlaydigan bir qator kengaytmalarni ham qo'llab-quvvatlaydi. Bularga quyidagilar kiradi:

<Callout type="info" emoji="">
* Ekran o'lchamlari va bir nechta monitorlarni boshqarish uchun RandR extensioni.
* Hardware-accelerate videoni ijro etish uchun XVideo extensioni.
* OpenGL orqali hardware-accelerated 3D grafika uchun GLX extensioni.
</Callout>

### Client-server model va network transparency

X client–server modelidan foydalanadi. X server dasturi grafik displeyli kompyuterda ishlaydi va turli client dasturlari bilan aloqa qiladi. X serveri user va client dasturlari oʻrtasida oʻzaro bogʻlovchi vazifasini bajaradi, client dasturlaridan grafik chiqish (oynalar)(graphical output (windows)) uchun TCP 6000 portidagi soʻrovlarni(requestlar) qabul qiladi va ularni userga koʻrsatadi (displey), shuningdek user maʼlumotlarini (klaviatura, sichqoncha) va uni client dasturlariga yuboradi. 


X server userning kompyuterida ishlaydi, clientlar esa masofaviy(remote) mashchinelarda ishlashi mumkin. Ushbu terminologiya client–server tizimlarining umumiy tushunchasini o'zgartiradi, bunda client odatda userning mahalliy(local) kompyuterida ishlaydi va server masofaviy(remote) kompyuterda ishlaydi. X Window terminologiyasi X Window dasturi barcha faoliyatning markazida ekanligi, ya'ni X Window dasturi applicationlardan hamda userning sichqoncha va klaviaturadan kiritgan so'rovlarini(request) qabul qiladi va ularga javob beradi. Shuning uchun applicationlar (remote kompyuterlarda) X Window server dasturining clientlari sifatida ko'riladi.

![X-SERVER](/images/article/linux-de/1.png)
![X-SERVER](/images/article/linux-de/2.gif)


### Core protocol

Server va clientlar o'rtasidagi aloqa tarmoq kanali(network channel) orqali paketlarni almashish orqali amalga oshiriladi. Client birinchi paketni yuborib, ulanishni o'rnatadi. Server ulanishni qabul qilish yoki rad etish yoki keyingi autentifikatsiya so'rovi bilan paketni qaytarib yuborish orqali javob beradi. Agar ulanish qabul qilingan bo'lsa, qabul paketi clientning server bilan keyingi o'zaro aloqasida foydalanishi uchun ma'lumotlarni o'z ichiga oladi. Ulanish o'rnatilgandan so'ng, client va server kanal orqali to'rt xil turdagi paketlarni almashadilar:

<Callout type="info" emoji="">
1. Request(So'rov): client serverdan ma'lumot so'raydi yoki biror amalni(action) bajarishni so'raydi.
2. Reply(Javob): server requestga javob beradi. Hamma so'rovlar ham javob bermaydi.
3. Event: server clientga eventni yuboradi, masalan, klaviatura yoki sichqoncha kiritish yoki oyna ko'chirilayotgan, o'lchami o'zgartirilgan yoki ochilgan.
4. Error(Xato): agar request noto'g'ri(invalid) bo'lsa, server error paketini yuboradi. Requestlar navbatga qo'yilganligi sababli, request tomonidan yaratilgan error paketlari darhol yuborilmasligi mumkin.
</Callout>

X server bir qator asosiy servicelarni taqdim etadi. Client dasturlari server bilan o'zaro aloqada bo'lish orqali yanada murakkab funksiyalarni amalga oshiradi.

### Windows(oynalar)

Boshqa grafik foydalanuvchi interfeyslari odatda window(oyna) deb ataladigan element X Window tizimidagi top-level windowdir. Window(Oyna) atamasi boshqa window ichida joylashgan windowlar, ya'ni ota-windowning subwindowlari uchun ham qo'llaniladi. Buttonlar(Tugmalar), menyular, piktogrammalar va boshqalar kabi grafik elementlarning barchasi oynalar yordamida amalga oshiriladi. Oyna faqat asosiy oynaning subwindowi sifatida yaratilishi mumkin. Bu oynalarni treeda ierarxik tarzda joylashtirishga olib keladi. X server avtomatik ravishda root(ildiz) oynasi deb ataladigan treening ildizini yaratadi. Top-leveldagi oynalar aynan ildiz oynasining bevosita subwindowlaridir. Ko'rinib turibdiki, root window ekran kabi katta va boshqa barcha oynalar orqasida yotadi.

![X-SERVER](/images/article/linux-de/3.png)

Rasmda: Ba'zi oynalarning mumkin bo'lgan joylashuvi: 1 - butun ekranni qoplaydigan ildiz oynasi(root window); 2 va 3 - top-leveldagi oynalar; 4 va 5 - 2 ning subwindowlari. Oynaning ota-onasidan tashqaridagi qismlari ko'rinmaydi

### Identifikatorlar

X serveri oynalar, shriftlar va boshqalar haqidagi barcha ma'lumotlarni saqlaydi. Client bu obyektlarning identifikatorlarini biladi - server bilan o'zaro aloqada bo'lganda ular uchun nom sifatida foydalanishi mumkin bo'lgan butun sonlar. Misol uchun, agar client oyna yaratilishini xohlasa, u serverdan uni yaratishni so'raydi va (muvaffaqiyatli bo'lsa) evaziga yangi yaratilgan oyna bilan bog'langan server identifikatorini oladi. Identifikator keyinchalik client tomonidan, masalan, oynada chizilgan satrni so'rash uchun ishlatilishi mumkin.

Identifikatorlar nafaqat clientga, balki serverga xosdir; masalan, ikkita turli client tomonidan yaratilgan bo'lsa ham, ikkita oynada bir xil identifikator mavjud emas. Clirnt identifikatori berilgan istalgan obyektga kirishi mumkin, hatto boshqa client obyektni yaratgan bo'lsa ham.

### Attributlar va propertilar

Har bir oynada oldindan belgilangan atributlar va propertielar to'plami mavjud bo'lib, ularning barchasi X serverida saqlanadi va tegishli so'rovlar orqali clientlarga kirish mumkin. Atributlar oyna haqidagi ma'lumotlar, masalan, uning o'lchami, joylashuvi, fon rangi va boshqalar. Propertielar - oynaga biriktirilgan ma'lumotlar bo'laklari. Atributlardan farqli o'laroq, X Window core protokoli darajasida propertielar hech qanday ma'noga ega emas. Client o'zboshimchalik bilan ma'lumotlarni oynaning propertisida saqlashi mumkin.

Propertie nomi, turi va qiymati bilan tavsiflanadi. Propertielar imperativ dasturlash tillaridagi o'zgaruvchilarga o'xshaydi, chunki application ma'lum nom va ma'lum turdagi yangi propertini yaratishi va unda qiymatni saqlashi mumkin. Propertielar oynalar bilan bog'langan: bir xil nomdagi ikkita properti har xil turdagi va qiymatlarga ega bo'lgan ikki xil oynada mavjud bo'lishi mumkin.

Propertielar asosan clientlar o'rtasidagi aloqa uchun ishlatiladi. Masalan, `WM_NAME` nomli properti oyna nomini saqlaydi; oyna menejerlari odatda bu xususiyatni o'qiydilar va uning yuqori qismida oyna nomini ko'rsatadilar.

`Xprop` dasturi oynaning propertilarini ko'rsatishi mumkin. Xususan, `xprop -root` X resurslarni (dasturlar parametrlarini) o'z ichiga olgan ildiz oynasining propertilarini ko'rsatadi.

### Eventlar

Eventlar - bu clientni qiziqtiradigan biror narsa sodir bo'lganligi haqida xabar berish uchun server tomonidan clientga yuborilgan paketlar. Client serverdan eventni boshqa clientga yuborishni so'rashi mumkin; Bu clientlar o'rtasidagi aloqa uchun ishlatiladi. Misol uchun, client hozirda tanlangan matnni so'raganda, event hozirda tanlovni ushlab turadigan oyna bilan ishlayotgan clientga yuboriladi.

Oynaning mazmuni ba'zi sharoitlarda (masalan, deraza qoplangan bo'lsa(window is covered)) "destroyed(yo'q qilish)" qilishi mumkin. Yo'q qilingan kontent maydoni ko'rinadigan bo'lsa, server clientga oynaning bir qismini chizish kerakligi haqida xabar berish uchun Expose eventini yaratadi.

Boshqa eventlar clientlarga klaviatura yoki sichqoncha kiritilishi, yangi oynalar yaratilishi va hokazolar haqida xabar berish uchun xizmat qilishi mumkin.

Ba'zi turdagi eventlar har doim clientga yuboriladi, lekin ko'pgina eventlar faqat client ularga qiziqish bildirgan taqdirdagina yuboriladi, chunki clientlar faqat qandaydir eventlarga qiziqishi mumkin. Misol uchun, client klaviatura bilan bog'liq eventga qiziqishi mumkin, ammo sichqoncha bilan bog'liq eventlar emas.

### Color modelar(Rang rejimlari)

X Window System ranglarni boshqarish usuli ba'zan foydalanuvchilarni chalkashtirib yuborishi mumkin va tarixan bir nechta turli xil rejimlar qo'llab-quvvatlanadi. Ko'pgina zamonaviy ilovalar to'liq rangdan foydalanadi (24-bit rang, qizil, yashil va ko'kning har biri uchun 8 bit), lekin eski yoki maxsus ilovalar boshqa rang rejimini talab qilishi mumkin. Ko'pgina tijorat mutaxassislari ilovalari `PseudoColor` dan foydalanadi.

X11 protokoli aslida ko'pgina grafik operatsiyalarda bitta rangni ifodalash uchun piksel qiymati deb ataladigan bitta 32 bitli belgisiz butun sondan foydalanadi. Asosiy ranglarning intensivligini uzatishda har bir rang komponenti uchun 16 bitli butun son ishlatiladi. Ranglarning quyidagi ko'rinishlari mavjud; ularning hammasi ham ma'lum bir qurilmada qo'llab-quvvatlanmasligi mumkin.

##### DirectColor

Piksel qiymati alohida qizil, yashil va ko'k pastki maydonlarga(subfield) bo'linadi. Har bir kichik maydon alohida colormapini indekslaydi. Barcha rang xaritalaridagi yozuvlarni o'zgartirish mumkin.

##### TrueColor

DirectColor bilan bir xil, faqat colormap yozuvlari hardware tomonidan oldindan belgilangan va ularni o'zgartirib bo'lmaydi. Odatda, qizil, yashil va ko'k rang colormaplarining har biri (near) chiziqli intensivlikni ta'minlaydi.

##### GrayScale
Piksel qiymati monoxrom intensivlikni o'z ichiga olgan bitta colormapini indekslaydi. Colormap yozuvlarini o'zgartirish mumkin.

##### StaticGray

GrayScale bilan bir xil, faqat colormapi yozuvlari hardware tomonidan oldindan belgilangan va ularni o'zgartirib bo'lmaydi.

##### PseudoColor (Chunky)

Piksel qiymati rang intensivligini o'z ichiga olgan bitta colormapini indekslaydi. Colormap yozuvlarini o'zgartirish mumkin.

##### StaticColor

PseudoColor bilan bir xil, faqat colormapi yozuvlari hardware tomonidan oldindan belgilangan va ularni o'zgartirib bo'lmaydi.

### Xlib va boshqa client librarilar

Ko'pgina client dasturlari Xlib clientlar kutubxonasi(librarie) orqali server bilan bog'lanadi. `Xlib` bilan bir qatorda, `XCB` kutubxonasi `X` protokoliga yaqinroq ishlaydi. Xususan, ko'pchilik clientlar `Xaw`, `Motif`, `GTK+` yoki `Qt` kabi kutubxonalardan foydalanadilar, ular o'z navbatida server bilan o'zaro aloqa qilish uchun `Xlib`-dan foydalanadilar. Qt 5.0 versiyasi bilan Xlib-dan `XCB`-ga o'tdi, ammo client dasturlari bu o'zgarishdan deyarli ta'sirlanmadi.


## Xlib va X display manager

X ning o'zi grafik foydalanuvchi interfeysini ta'minlamaydi, lekin u GUI va tarmoq shaffofligini(network transparency) yaratish uchun qurilish bloklarini taqdim etadi, bu dastur uchun grafik interfeysni dastur ishlayotganidan boshqa mashinada ko'rsatishga imkon beradi.

X tizimi bir nechta komponentlardan iborat. Ushbu komponentlardan ikkitasi X Displey menejeri va Xlib kutubxonasi bo'lib, ular bir-biri bilan va X tizimining boshqa komponentlari bilan o'zaro aloqada bo'lib, grafik interfeyslarni boshqarish uchun to'liq muhitni ta'minlaydi.

Keling, har bir komponentni batafsil ko'rib chiqaylik:

X Displey menejeri (XDM): X Displey menejeri X serverida ishlaydigan seansni boshlash uchun standart mexanizmni taqdim etadi. XDM XDM bilan bir xil machineda yoki turli machinelarda ishlashi mumkin bo'lgan X serverlar to'plamini boshqaradi. U X serverini ishga tushirish, foydalanuvchini autentifikatsiya qilish va seansni boshlash xizmatlarini taqdim etadi. Seans boshlangandan so'ng, boshqaruv oyna boshqaruvchisiga topshiriladi. Seans tugagach, boshqaruv XDM ga qaytadi.

Xlib kutubxonasi: Bu X Window tizimidan foydalanadigan applicationlarni yozish uchun standart C kutubxonasi. Bu X server protokoli uchun low-leveldagi interfeys bo'lib, asosan X serveriga requestlar(so'rov) yuboradigan va responselarni(javoblar) qabul qiluvchi funksiyalarni ta'minlaydi. Ushbu kutubxona X serveriga ulanish, oyna yaratish, asosiy shakllarni chizish, input eventlarni boshqarish va clientlar va X server o'rtasidagi aloqani boshqarish kabi vazifalarni bajaradi.

Keling, o'zaro ta'sirni ko'rib chiqaylik:

X Displey menejeri yangi X sessiyasini ishga tushirish va ishga tushirishni boshqaradi. U displeyni boshqaradigan X serveri bilan bog'lanadi. X server ishga tushganda, u X clientlari bilan aloqa qilish uchun network socketini ochadi. X tizimi tomonidan taqdim etilgan network transparency tufayli bu clientlar local yoki boshqa machineda bo'lishi mumkin.

Xlib kutubxonasi X serveri bilan o'zaro aloqada bo'lgan har qanday dastur bo'lishi mumkin bo'lgan X clientini yozayotganda ishga tushadi. Xlib tomonidan taqdim etilgan funksiyalardan foydalanib, X clienti X serveriga ulanishni ochishi, oynalarni yaratishi va boshqarishi, bu oynalarda grafiklarni chizishi, klaviatura va sichqonchadan kiritilgan ma'lumotlarni boshqarishi va hokazo. Shu tarzda, Xlib applicationlar uchun X server tomonidan taqdim etilgan servicelardan foydalanish usulini taqdim etadi.

Displey menejeri kontekstida X serverini Displey menejeri va haqiqiy foydalanuvchi sessiyasi o'rtasidagi vositachi sifatida ko'rish mumkin. Displey menejeri yangi seansni boshlaganida, u boshqaruvni X mijozi bo'lgan va X server bilan bog'lanish uchun Xlib dan foydalanadigan oyna boshqaruvchisiga topshiradi.

X Displey menejeri umumiy jarayonni boshqaradi, X server displeyni boshqaradi va Xlib kutubxonasi applicationlar uchun (jumladan, oyna(window) menejeri va boshqa X clientlari) X server bilan o'zaro aloqada bo'lish usulini taqdim etadi. Ushbu komponentlar birgalikda Unix-ga o'xshash tizimlarda grafik interfeyslarni ishga tushirish uchun to'liq muhitni ta'minlaydi.