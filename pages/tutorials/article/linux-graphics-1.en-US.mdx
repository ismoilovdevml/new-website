import { Callout } from "nextra-theme-docs";

# Linuxda Grafika

Maqolaning maqsadi

Ushbu keng qamrovli maqolaning maqsadi Linux operatsion tizimidagi grafikalarning nozik tomonlarini yoritishdir. Linux server muhitida, embedded tizimlarda va yaqinda, hatto iste'molchi uchun ish-stollarida keng qo'llanilishiga qaramay, ko'plab foydalanuvchilar va ishlab chiquvchilar uning grafik quyi tizimi bilan to'liq tanish emas. Ushbu qism dasturiy ta'minot ishlab chiquvchilari, Linux ishqibozlari, system administratorlar va Linuxning grafika bilan qanday ishlashini tushunishga qiziqqan barcha texnologiyaga ega bo'lgan barcha shaxslar uchun manba bo'lib xizmat qilishiga qaratilgan.


#### Linux grafikasi haqida qisqacha ma'lumot

Linuxda grafik ishlov berish - bu ekranda vizual chiqishni ta'minlash uchun uzluksiz o'zaro ta'sir qiluvchi komponentlar majmuasini o'z ichiga olgan murakkab, ko'p bosqichli jarayon. Ushbu komponentlar qatoriga 2D va 3D vektorli grafikalarni koʻrsatish, GUI yaratish, software applicationlar va grafik hardwarelar oʻrtasidagi aloqani taʼminlashgacha boʻlgan bir qator funksiyalarni taklif qiluvchi librarylar kiradi.

Bundan tashqari, Linux grafik muhiti doimiy ravishda rivojlanib bormoqda, landshaftni qayta belgilashga qaratilgan yangi tendentsiyalar va texnologiyalar. Ushbu maqola Linuxning grafik ishlovi, librarylar(kutubxona), kernel roli, jalb qilingan drayverlar va ushbu makonni shakllantiradigan kelajakdagi qiziqarli tendentsiyalarni to'liq ko'rib chiqadigan ushbu elementlarni o'rganadi.

Ushbu maqolaning oxiriga kelib, o'quvchilar Linuxda grafikalar haqida yaxshi tushunchaga ega bo'ladilar, bu esa rivojlanish, muammolarni bartaraf etish yoki shunchaki shaxsiy qiziqishni qondirish uchun keyingi tadqiqotlar uchun mustahkam poydevor yaratadi. Keling, Linux grafikasining jozibali dunyosiga sayohatimizni boshlaylik.


## Linux Graphics Stack

Linux Graphics Stack - bu layerli structura(qatlamli tuzulma) bo'lib, u kompyuter applicationlariga kompyuter ekranida tasvirlarni yaratish, o'zgartirish va ko'rsatish imkonini beradi. Stack application leveldan boshlanadi va hardwaregacha bo'lgan jarayonni o'z ichiga oladi. Buni layerma-layer ko'rib chiqanuz


`Application Layer` stackning yuqori qismi applicationlar joylashgan joy. Bu sizning web-browserngiz, matn muhariringiz yoki ekraningizga tasvir yoki matnni ko'rsatishi kerak bo'lgan boshqa turdagi application(dastur, ilova) bo'lishi mumkin.

`Toolkit Layer` Applicationlar foydalanuvchi interfeyslarini(user interface) ko'rsatishga yordam berish uchun ko'pincha grafik toolkitlardan foydalanadilar. Ushbu toolkitlar tugmalar(button), matn maydonchalari(text boxes), slayderlar(slider) va boshqalar kabi oldindan tayyorlangan elementlar kutubxonalarini taqdim etadi. Masalan, `GTK`, `Qt` yoki `FLTK`.

`Window System Layer` Keyingi layer Window System Layer. Ushbu layer oynalarni(window) boshqa joyga ko'chirish, o'lchamlarini o'zgartirish yoki Z-tartibini o'zgartirish kabi asosiy imkoniyatlarni taqdim etadi. Ko'pgina Linux tizimlarida bu `X Window System (X11)` yoki `Wayland` bo'ladi.

`Compositing Window Manager` Window System Layerning ustiga qo'yish - Compositing Window Manager. Hamma tizimlarda ham bunday layer bo'lmaydi. Compositing Window Managerlari (masalan, Compiz yoki Mutter) ekranga yuborishdan oldin oynalarni buferga birlashtiradi. Bu shaffoflik(transparency), animatsiya yoki 3D desktop kabi effektlarni beradi.

`Window System Server Layer` Window System Server Layeri client applicationlari(mijoz ilovalari) va display hardware o'rtasidagi aloqani boshqarish uchun javobgardir. Linuxda buning eng keng tarqalgan misoli `X11` bilan ishlaydigan tizimlardagi `X Server` bo'lishi mumkin.

`Graphics Library Layer`  Window System Serveri ostida Graphics Library(grafik kutubxona) joylashgan. Bu dasturiy ta'minotning GPU bilan standartlashtirilgan tarzda o'zaro ishlashiga imkon beruvchi APIni taqdim etadi. Bu yerda asosiy misol - `OpenGL` va `Vulkan` kabi bir nechta grafik API-larni amalga oshiradigan `Mesa`.

`Kernel Mode Setting (KMS) va Direct Rendering Manager (DRM) layeri` Bu layer to'g'ridan-to'g'ri kernel bilan ishlaydi. KMS resolutionni aniqlash, rang chuqurligi(color depth) va refresh rateni(yangilanish tezligi) uchun javobgardir. DRM Linux kernelining subsystem(quyi tizi)mi bo'lib, u GPU-lar bilan interfeysga ega va memory management, interrupt handling va DMA kabi vazifalarni bajaradi.

`Kernel Layer` kernel operatsion tizimning asosiy qismidir. U to'g'ridan-to'g'ri hardware bilan bog'lanadi va memory management va task scheduling(vazifalarni rejalashtirish) kabi low-leveldagi service(xizmat)larni taqdim etadi.

`Hardware Layer` stackning pastki qismi actual grafik hardwaredir. Bu `NVIDIA GeForce`, `AMD Radeon` yoki `Intel` integratsiya qilingan GPU kabi bo'lishi mumkin bo'lgan grafik kartangiz.

Stackning har bir layer(qatla)mi to'g'ridan-to'g'ri uning ustidagi va ostidagi layerlar bilan bog'lanib, abstraktsiya darajasini ta'minlaydi. Bu dasturiy ta'minotni ishlab chiquvchilarga boshqa layerlarning barcha tafsilotlarini tushunmasdan turib, o'zlarining maxsus vazifalariga e'tibor qaratish imkonini beradi.

## Kernel Mode Setting (KMS)


Kernel Mode Setting (KMS) Linux kerneli grafik stackidagi metod bo'lib, kernelga grafik rejim displeylari bilan bog'liq sozlamalarni boshqarish imkonini beradi. Bu kernelga grafik qurilmalar ustidan toʻliq nazoratni taʼminlovchi texnika boʻlib, flicker-free boot processlari(miltillashsiz yuklash), crash recovery va multi-seat computing kabi qator afzalliklarni beradi.
![Image](/images/article/linux-de/15.jpg)

KMS dan oldin User Mode Setting (UMS) ishlatilgan, bu yerda rejimni sozlash operatsiyalari X serveri tomonidan user spaceda amalga oshirilgan. Biroq, KMS-ga o'tish X serverining endi imtiyozsiz ishlashini anglatadi, bu esa umuman xavfsizroq tizimni ta'minlaydi.

KMSning texnik tomonini yaxshiroq ko'rib chiqamiz

`Responsibility of KMS`  Nomidan ko'rinib turibdiki, rejim sozlamalari(mode setting) monitoringizning piksellar sonini, rang chuqurligini(color depth) va yangilanish tezligini(refresh rate) sozlashdir. KMS shuningdek, matn va grafik konsollar o'rtasida almashinish, bir nechta monitorlarni sozlash va to'xtatib turish(suspend) va davom ettirish hodisalarini boshqarish uchun javobgardir.

`DRM/KMS API` KMS Linux kernelidagi subsystem(quyi tizim) bo'lgan Direct Rendering Manager (DRM) orqali amalga oshiriladi. Bu user space dasturlari buyruqlar va ma'lumotlarni GPUga yuborish uchun foydalanishi mumkin bo'lgan APIni taqdim etadi. Ushbu API frame bufferlarini yaratish va boshqarish, monitor rejimini o'rnatish va framelar orasidagi smooth transition uchun sahifalarni aylantirish(page flipping) funksiyalarini o'z ichiga oladi.
![Image](/images/article/linux-de/13.png)
![Image](/images/article/linux-de/14.png)

`Frame Buffer va Display Controllers:` Frame Buffer(Kadr bufer)i display controller tomonidan displeyga yuboriladigan bitmapni o'z ichiga olgan RAMning bir qismidir. KMS user applicationlariga frame bufferlarini yaratish va ular bilan bog'liq event(hodisa)larni boshqarish imkonini beradi. KMS GPUda mavjud bo'lgan `CRTCs` (Cathode Ray Tube Controllers) yoki display controllerlarini boshqaradi, ular frame buferidan ma'lumotlarni o'qiydi va ularni display hardwarega uzatadi.

![Frame Buffer](/images/article/linux-de/9.jpg)
![Frame Buffer](/images/article/linux-de/10.jpg)
![Frame Buffer](/images/article/linux-de/11.jpg)
![Frame Buffer](/images/article/linux-de/12.jpg)

`Atomic Mode Setting` An'anaviy KMSga nisbatan yaxshilanish sifatida kiritilgan Atomic Mode Setting - bu displey rejimlarini atomic tarzda yoki bir vaqtning o'zida(all-at-once) sozlash imkonini beruvchi metod. Ilgari, displey rejimini o'rnatish uchun bir nechta `IOCTLs (I/O Controls)` kerak edi va har bir IOCTL mos kelmaydigan holatlarga olib keladigan muvaffaqiyatsizlik ehtimoli bor edi. Atom rejimini sozlash barcha o'zgarishlarni bir vaqtning o'zida amalga oshirishga ruxsat berish orqali bu muammoni hal qiladi, barqaror va xatosiz rejim sozlamalarini ta'minlaydi.

`Boshqa komponentlar bilan o'zaro ta'sir` KMS Linux grafik stackining boshqa qismlari, masalan, Mesa (3D grafikalar uchun umumiy interfeysni ta'minlovchi user-space grafik kutubxonasi) va X server yoki Wayland (kirish va oynalarni boshqarish uchun mas'ul) bilan birgalikda ishlaydi.

KMS dan foydalanish va uning davom etayotgan takomillashtirilishi displey miltillashini kamaytirish va zamonaviy grafik hardware va funksiyalarni yaxshiroq qo'llab-quvvatlash orqali Linuxda foydalanuvchi tajribasini sezilarli darajada yaxshiladi.


## Direct Rendering Manager (DRM)

Direct Rendering Manager (DRM) Linux kernelining quyi tizimi(subsystem) bo'lib, zamonaviy video kartalarning GPU-lari bilan o'zaro bog'lanish uchun javobgardir va dasturlarning grafik qurilmalar bilan o'zaro ta'siri uchun umumiy API taqdim etadi. DRM user space dasturlari buyruqlar va ma'lumotlarni GPUga yuborish va displeyning rejim sozlamalarini sozlash kabi operatsiyalarni bajarish uchun foydalanishi mumkin bo'lgan APIni ochib beradi. DRM birinchi marta X Server Direct Rendering Infratuzilmasining kernel-space komponenti sifatida ishlab chiqilgan , ammo o'shandan beri u Wayland kabi boshqa grafik stack alternativlari va `SDL2 `va `Kodi` kabi mustaqil ilovalar va kutubxonalar tomonidan qo'llanila boshlandi.

User-space dasturlar DRM API-dan GPU-ga hardware-accelerator 3D renderlash va video dekodlash(video decoding), shuningdek, `GPGPU` hisoblashlarini buyurish uchun foydalanishi mumkin. DRM dastlab `XFree86` da Direct Rendering Infrastructure (DRI) qo'llab-quvvatlash uchun ishlab chiqilgan, ammo keyinchalik turli xil grafik funksiyalarni boshqarish uchun kengaytirilgan.

DRM bir necha qismlardan iborat

`Kernel` Bu DRM ning asosiy funksiyalarini, jumladan ishga tushirish(initialization) va tozalashni(cleanup) boshqarish, xotirani boshqarish(memory management), interrupt handling va DMA bilan ta'minlaydi.

`DRM qurilma drayverlari` Bular har bir grafik kartaga xos bo'lib, hardwarening low-leveldagi tafsilotlarini boshqarish uchun javobgardir. Ular odatda hardware ishlab chiqaruvchilari tomonidan yoziladi, garchi open-source versiyalari ham mavjud.

`Graphics Execution Manager (GEM)` Bu GPU xotirasini boshqarish uchun API. U Intel tomonidan eski `TTM` (Translation Table Maps) boshqaruvchisini almashtirish uchun ishlab chiqilgan va hozirda ko'pgina yirik GPU ishlab chiqaruvchilari tomonidan foydalaniladi. GEM xotirani taqsimlash, almashtirish va GPU uchun ishlov berish bilan shug'ullanadi, shuningdek, turli jarayonlar o'rtasida xotira buferlarini almashish mexanizmini taqdim etadi.

`Kernel Mode Setting (KMS)` Bu kernel modeni sozlash imkonini beruvchi DRM xususiyatidir. Rejimni sozlash(mode setting) - bu video kartaning chiqish formatini (masalan, resolution,, color depth va refresh rate) sozlash jarayoni. Kernelda handling mode settingni sozlash bir qator afzalliklarga ega, masalan, xatolarni yanada ishonchli tiklash va foydalanuvchi interfeyslari o'rtasida yumshoqroq o'tish.

`DMA-BUF` Bu turli drayverlarga bir xil xotira buferini almashish imkonini beruvchi bufer almashish mexanizmi. Bu, ayniqsa, murakkab grafik sozlamalari uchun foydalidir, bu yerda ma'lumotlar bir nechta GPU o'rtasida yoki GPU va video dekoderlar yoki displey kontrollerlari kabi boshqa qurilmalar o'rtasida almashish kerak bo'lishi mumkin.

DRM ekranda grafiklarni ko'rsatish bilan bog'liq vazifalarni boshqarishda asosiy rol o'ynaydi, grafik qurilmaning murakkabligini mavhumlashtiradi va Linux grafik stackidagi yuqori qatlamlarga asosiy grafik uskunasining o'ziga xos xususiyatlaridan tashvishlanmaslik imkonini beradi.

Texnik darajada, DRM user-space applicationlarga `ioctl` sstem callari orqali buyruqlarni GPUga yuborishga ruxsat berish orqali erishadi. DRM drayveri ushbu buyruqlarni GPUdagi buyruqlar navbatlariga(command queue) surishdan oldin tasdiqlaydi. Zamonaviy GPU-larda bir nechta buyruqlar navbati(multiple command queue) bir vaqtning o'zida bir nechta vazifalarni bajarish uchun ishlatilishi mumkin, bu esa GPU-dan umumiy foydalanish va unumdorlikni oshiradi.

## Mesa3D

Mesa, shuningdek, `Mesa3D` va `The Mesa 3D Graphics Library` deb ataladi, `OpenGL`, `Vulkan` va boshqa grafik API spetsifikatsiyalarining open-source implementationi. Mesa ushbu spetsifikatsiyalarni vendor-specific grafik qurlma drayverlariga tarjima qiladi.  Uning eng muhim foydalanuvchilari asosan Intel va AMD tomonidan o'zlarining tegishli qurilmalari uchun ishlab chiqilgan va moliyalashtirilgan ikkita grafik drayverdir (AMD o'zlarining Mesa drayverlarini Radeon va RadeonSI-ni eskirgan AMD Catalyst orqali targ'ib qiladi va Intel faqat Mesa drayverini qo'llab-quvvatlaydi). Xususiy grafik drayverlar (masalan, Nvidia GeForce drayveri va Catalyst) barcha Mesa-ning o'rnini bosadi va grafik API-ni o'z amalga oshirishini ta'minlaydi. `Nouveau` deb nomlangan Mesa Nvidia drayverini yozish bo'yicha op-souce harakat asosan hamjamiyat tomonidan ishlab chiqilgan. O'yinlar kabi 3D ilovalardan tashqari, zamonaviy displey serverlari (X.org, `Glamour` yoki `Wayland Weston`) `OpenGL/EGL`dan foydalanadi; shuning uchun barcha grafikalar odatda Mesa orqali o'tadi. 

Mesa `freedesktop.org` saytida joylashgan va `1993 yil avgust` oyida loyihada hali ham faol bo'lgan `Brayan Pol` tomonidan boshlangan. Keyinchalik Mesa keng tarqalgan bo'lib qabul qilindi va hozirda butun dunyo bo'ylab turli shaxslar va korporatsiyalarning, shu jumladan OpenGL spetsifikatsiyasini boshqaruvchi Khronos Group grafik qurilmalari ishlab chiqaruvchilarining ko'plab hissalarini o'z ichiga oladi. Linux uchun rivojlanish qisman crowdfunding tomonidan ham amalga oshirildi.